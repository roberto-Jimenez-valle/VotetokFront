<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificar Autenticaci√≥n - VouTop</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0a0a0f;
            color: #fff;
        }
        .section {
            background: #1a1a2e;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        h1 {
            color: #4ecdc4;
        }
        h2 {
            color: #96ceb4;
            margin-top: 0;
        }
        pre {
            background: #0a0a0f;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .status.ok {
            background: #2ecc71;
            color: #000;
        }
        .status.error {
            background: #e74c3c;
            color: #fff;
        }
        button {
            background: #4ecdc4;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        button:hover {
            background: #45b7d1;
        }
        button.danger {
            background: #e74c3c;
            color: #fff;
        }
    </style>
</head>
<body>
    <h1>üîê Verificador de Autenticaci√≥n VouTop</h1>
    
    <div class="section">
        <h2>Estado de Autenticaci√≥n</h2>
        <div id="auth-status"></div>
    </div>
    
    <div class="section">
        <h2>Token JWT</h2>
        <div id="token-info"></div>
    </div>
    
    <div class="section">
        <h2>Datos del Usuario</h2>
        <div id="user-info"></div>
    </div>
    
    <div class="section">
        <h2>Acciones</h2>
        <button onclick="testCreatePoll()">üß™ Probar Crear Encuesta</button>
        <button onclick="clearAuth()" class="danger">üóëÔ∏è Limpiar Autenticaci√≥n</button>
        <button onclick="location.reload()">üîÑ Recargar</button>
    </div>
    
    <div class="section" id="test-result" style="display: none;">
        <h2>Resultado de la Prueba</h2>
        <div id="test-output"></div>
    </div>

    <script>
        // Verificar autenticaci√≥n
        function checkAuth() {
            const token = localStorage.getItem('voutop-auth-token');
            const user = localStorage.getItem('voutop-user');
            
            const statusEl = document.getElementById('auth-status');
            const tokenEl = document.getElementById('token-info');
            const userEl = document.getElementById('user-info');
            
            if (token && user) {
                statusEl.innerHTML = `<span class="status ok">‚úÖ AUTENTICADO</span>`;
                
                // Mostrar token (primeros y √∫ltimos caracteres)
                const tokenPreview = token.length > 50 
                    ? `${token.substring(0, 30)}...${token.substring(token.length - 20)}`
                    : token;
                tokenEl.innerHTML = `<pre>${tokenPreview}</pre><p>Longitud: ${token.length} caracteres</p>`;
                
                // Mostrar datos del usuario
                try {
                    const userData = JSON.parse(user);
                    userEl.innerHTML = `<pre>${JSON.stringify(userData, null, 2)}</pre>`;
                } catch (err) {
                    userEl.innerHTML = `<span class="status error">‚ùå Error al parsear datos del usuario</span>`;
                }
            } else {
                statusEl.innerHTML = `<span class="status error">‚ùå NO AUTENTICADO</span>`;
                tokenEl.innerHTML = '<p>No hay token guardado</p>';
                userEl.innerHTML = '<p>No hay datos de usuario</p>';
            }
        }
        
        // Probar crear una encuesta
        async function testCreatePoll() {
            const resultEl = document.getElementById('test-result');
            const outputEl = document.getElementById('test-output');
            
            resultEl.style.display = 'block';
            outputEl.innerHTML = '<p>‚è≥ Enviando solicitud...</p>';
            
            const token = localStorage.getItem('voutop-auth-token');
            
            if (!token) {
                outputEl.innerHTML = '<span class="status error">‚ùå No hay token. Inicia sesi√≥n primero.</span>';
                return;
            }
            
            try {
                const testPoll = {
                    title: "Encuesta de prueba - Autenticaci√≥n",
                    description: "Esta es una prueba del sistema de autenticaci√≥n",
                    category: "general",
                    type: "world",
                    options: [
                        { key: "opt1", label: "Opci√≥n 1", color: "#ff6b6b" },
                        { key: "opt2", label: "Opci√≥n 2", color: "#4ecdc4" }
                    ],
                    settings: {
                        allowMultipleAnswers: false,
                        showResults: true
                    }
                };
                
                const response = await fetch('https://voutop.com/api/polls', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(testPoll)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    outputEl.innerHTML = `
                        <span class="status ok">‚úÖ √âXITO - Encuesta creada</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    outputEl.innerHTML = `
                        <span class="status error">‚ùå ERROR ${response.status}</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                outputEl.innerHTML = `
                    <span class="status error">‚ùå ERROR DE RED</span>
                    <pre>${error.message}</pre>
                `;
            }
        }
        
        // Limpiar autenticaci√≥n
        function clearAuth() {
            if (confirm('¬øSeguro que quieres cerrar sesi√≥n?')) {
                localStorage.removeItem('voutop-auth-token');
                localStorage.removeItem('voutop-user');
                location.reload();
            }
        }
        
        // Ejecutar al cargar
        checkAuth();
    </script>
</body>
</html>
